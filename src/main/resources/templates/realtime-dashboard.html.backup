<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ - Search Insights</title>
  
  <!-- CSS íŒŒì¼ë“¤ -->
  <link rel="stylesheet" th:href="@{/css/dashboard-main.css}">
  <link rel="stylesheet" th:href="@{/css/dashboard-dark-theme.css}">
  <link rel="stylesheet" th:href="@{/css/dashboard-components.css}">
</head>
<body>
<div class="container">
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    h1 {
      background: linear-gradient(135deg, #00d4ff 0%, #b794f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 15px;
      font-weight: 600;
      letter-spacing: -0.5px;
    }
    .dashboard-box {
      margin-top: 20px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }
    .dashboard-box:hover {
      border-color: rgba(0, 212, 255, 0.3);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.1);
    }
    .dashboard-title {
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 12px;
      font-size: 0.95em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 0.9;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 12px 10px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      color: #e4e4e7;
    }
    tr:hover td {
      background: rgba(255, 255, 255, 0.02);
    }
    th {
      background: rgba(255, 255, 255, 0.03);
      color: #b8b8bc;
      font-weight: 500;
      text-transform: uppercase;
      font-size: 0.75em;
      letter-spacing: 0.5px;
    }
    .active-users {
      font-size: 32px;
      font-weight: 700;
      background: linear-gradient(135deg, #00d4ff 0%, #b794f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
    }
    .update-time {
      font-size: 11px;
      color: #6b7280;
      text-align: right;
      opacity: 0.7;
      font-weight: 400;
    }
    .progress-bar {
      background: rgba(255, 255, 255, 0.05);
      height: 6px;
      border-radius: 3px;
      margin-right: 10px;
      overflow: hidden;
    }
    .progress-value {
      background: linear-gradient(90deg, #00d4ff 0%, #b794f6 100%);
      height: 6px;
      border-radius: 3px;
      box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
      transition: width 0.5s ease;
    }

    /* ë©”ì¸ íƒ­ ìŠ¤íƒ€ì¼ë§ */
    .main-tabs {
      display: flex;
      margin-bottom: 25px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      gap: 5px;
    }
    .main-tab {
      padding: 12px 24px;
      cursor: pointer;
      border: 1px solid transparent;
      border-bottom: none;
      border-radius: 12px 12px 0 0;
      background: rgba(255, 255, 255, 0.02);
      margin-right: 2px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 500;
      font-size: 0.9em;
      letter-spacing: 0.3px;
      position: relative;
      overflow: hidden;
    }
    .main-tab:hover {
      background: rgba(0, 212, 255, 0.05);
      border-color: rgba(0, 212, 255, 0.2);
      transform: translateY(-2px);
    }
    .main-tab::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.2), transparent);
      transition: left 0.5s;
    }
    .main-tab:hover::before {
      left: 100%;
    }
    .main-tab.active {
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.15) 0%, rgba(183, 148, 246, 0.15) 100%);
      color: #ffffff;
      font-weight: 600;
      transform: translateY(-2px);
      border: 1px solid rgba(0, 212, 255, 0.3);
      box-shadow: 0 -2px 20px rgba(0, 212, 255, 0.2),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    /* ì„œë¸Œ íƒ­ ìŠ¤íƒ€ì¼ë§ */
    .sub-tabs {
      display: flex;
      margin-bottom: 20px;
      margin-top: 15px;
      gap: 8px;
      align-items: center;
    }
    .sub-tab {
      padding: 8px 20px;
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 100px;
      background: rgba(255, 255, 255, 0.02);
      margin-right: 0;
      font-size: 0.85em;
      font-weight: 500;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
    }
    .sub-tab:hover {
      background: rgba(0, 212, 255, 0.08);
      border-color: rgba(0, 212, 255, 0.3);
      transform: translateY(-1px) scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 212, 255, 0.15);
    }
    .sub-tab.active {
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(183, 148, 246, 0.2) 100%);
      color: #00d4ff;
      font-weight: 600;
      border-color: rgba(0, 212, 255, 0.4);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.2),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.5s;
    }
    .tab-content.active {
      display: block;
    }

    .sub-tab-content {
      display: none;
      animation: fadeIn 0.5s;
    }
    .sub-tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* ê·€ì—¬ìš´ ì•„ì´ì½˜ë“¤ */
    .heart-icon {
      color: #ff4081;
      margin-right: 5px;
    }

    .date-selector {
      display: flex;
      align-items: center;
      margin: 15px 0;
      gap: 10px;
    }

    .date-selector input[type="date"] {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .fetch-btn {
      padding: 10px 24px;
      background: linear-gradient(135deg, #00d4ff 0%, #b794f6 100%);
      color: white;
      border: none;
      border-radius: 100px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9em;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
      position: relative;
      overflow: hidden;
    }

    .fetch-btn:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 25px rgba(0, 212, 255, 0.4);
    }
    .fetch-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    .fetch-btn:active::before {
      width: 300px;
      height: 300px;
    }

    .auto-update-check {
      margin-left: 15px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .category-icon {
      color: #9C27B0;
      margin-right: 5px;
    }

    /* ë™ê¸°í™” ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .sync-button {
      background: linear-gradient(135deg, #b794f6 0%, #9f7aea 100%);
      color: white;
      border: 1px solid rgba(183, 148, 246, 0.3);
      padding: 10px 24px;
      border-radius: 100px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      margin-left: auto;
      gap: 6px;
      box-shadow: 0 4px 15px rgba(183, 148, 246, 0.3);
      backdrop-filter: blur(10px);
    }

    .sync-button:hover {
      background: linear-gradient(135deg, #d6b4fc 0%, #b794f6 100%);
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 6px 20px rgba(183, 148, 246, 0.4);
      border-color: rgba(183, 148, 246, 0.5);
    }

    /* ë™ê¸°í™” ìƒíƒœ ì•Œë¦¼ ë°°ë„ˆ */
    .sync-banner {
      background: linear-gradient(135deg, rgba(183, 148, 246, 0.15) 0%, rgba(0, 212, 255, 0.15) 100%);
      color: #b794f6;
      padding: 12px 20px;
      border-radius: 10px;
      margin: 15px 0;
      display: none;
      align-items: center;
      text-align: center;
      font-weight: 600;
      font-size: 0.9em;
      border: 1px solid rgba(183, 148, 246, 0.3);
      backdrop-filter: blur(10px);
    }

    .sync-banner.visible {
      display: flex;
      justify-content: center;
    }

    .sync-button-icon {
      margin-right: 5px;
    }

    .full-sync-button {
      background: linear-gradient(135deg, #ff006e 0%, #ff4458 100%);
      margin-left: 10px;
      border: 1px solid rgba(255, 0, 110, 0.3);
    }

    .full-sync-button:hover {
      background: linear-gradient(135deg, #ff4081 0%, #ff006e 100%);
      box-shadow: 0 6px 20px rgba(255, 0, 110, 0.4);
      border-color: rgba(255, 0, 110, 0.5);
    }

    /* ì¹´í…Œê³ ë¦¬ í•„í„° ìŠ¤íƒ€ì¼ */
    .category-filter-container {
      display: none;
      align-items: center;
      gap: 10px;
      margin-left: 15px;
    }

    .category-filter-container.visible {
      display: flex;
    }
    
    /* ì²˜ìŒ ë¡œë“œì‹œ ì „ì²´ ì œëª© íƒ­ì˜ ë“œë¡­ë‹¤ìš´ í‘œì‹œ */
    #today-full-category-filter {
      display: flex;
    }
    
    #custom-date-full-category-filter {
      display: flex;
    }

    .category-dropdown {
      padding: 8px 20px;
      border: 1px solid rgba(183, 148, 246, 0.3);
      border-radius: 100px;
      background: rgba(255, 255, 255, 0.02);
      color: #b794f6;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.85em;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      min-width: 150px;
      backdrop-filter: blur(10px);
    }
    .category-dropdown option {
      background: #1a1a1a;
      color: #e4e4e7;
    }

    .category-dropdown:hover {
      background: rgba(183, 148, 246, 0.1);
      border-color: rgba(183, 148, 246, 0.5);
      box-shadow: 0 0 15px rgba(183, 148, 246, 0.2);
    }

    .category-dropdown:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(183, 148, 246, 0.4);
      border-color: rgba(183, 148, 246, 0.6);
    }

    .category-label {
      color: #b794f6;
      font-weight: 600;
      font-size: 0.85em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* ê¸°ê°„ ë¹„êµ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
    .period-comparison-container {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      align-items: center;
    }

    .period-box {
      flex: 1;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      background-color: #f9f9f9;
    }

    .period-box.period-a {
      border-color: rgba(33, 150, 243, 0.5);
      background: rgba(33, 150, 243, 0.15);
    }
    .period-box.period-a:hover {
      border-color: rgba(33, 150, 243, 0.7);
      box-shadow: 0 0 20px rgba(33, 150, 243, 0.3);
    }

    .period-box.period-b {
      border-color: rgba(255, 152, 0, 0.5);
      background: rgba(255, 152, 0, 0.15);
    }
    .period-box.period-b:hover {
      border-color: rgba(255, 152, 0, 0.7);
      box-shadow: 0 0 20px rgba(255, 152, 0, 0.3);
    }

    .period-title {
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 10px;
      color: #ffffff;
    }

    .vs-symbol {
      font-size: 1.5em;
      font-weight: bold;
      color: #666;
    }

    .compare-btn {
      padding: 12px 28px;
      background: linear-gradient(135deg, #00d4ff 0%, #b794f6 100%);
      color: white;
      border: none;
      border-radius: 100px;
      cursor: pointer;
      font-size: 0.95em;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      margin-left: 20px;
      box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
    }

    .compare-btn:hover {
      background-color: #7B1FA2;
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(156, 39, 176, 0.3);
    }

    .increase {
      color: #10b981;
      font-weight: 600;
      text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
    }

    .decrease {
      color: #ef4444;
      font-weight: 600;
      text-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
    }

    .unchanged {
      color: #6b7280;
      opacity: 0.7;
    }

    .change-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 100px;
      font-size: 0.75em;
      margin-left: 8px;
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    .change-badge.increase {
      background: rgba(16, 185, 129, 0.15);
      color: #10b981;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .change-badge.decrease {
      background: rgba(239, 68, 68, 0.15);
      color: #ef4444;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .smart-filter {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 6px 15px;
      border: 1px solid #ddd;
      border-radius: 20px;
      background-color: white;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.2s;
    }

    .filter-btn:hover {
      background-color: #f5f5f5;
      border-color: #9C27B0;
    }

    .filter-btn.active {
      background-color: #9C27B0;
      color: white;
      border-color: #9C27B0;
    }

    .expandable-row {
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .expandable-row:hover {
      background: rgba(255, 255, 255, 0.02);
      transform: scale(1.002);
    }

    .detail-row {
      display: none;
      background: rgba(0, 0, 0, 0.2);
      border-left: 2px solid rgba(0, 212, 255, 0.3);
    }

    .detail-row.visible {
      display: table-row;
    }

    .detail-content {
      padding: 10px 20px;
    }

    /* ë¹ ë¥¸ ë‚ ì§œ ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .quick-date-buttons {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .quick-date-btn {
      padding: 5px 12px;
      border: 1px solid #ddd;
      border-radius: 15px;
      background-color: white;
      cursor: pointer;
      font-size: 0.85em;
      transition: all 0.2s;
    }

    .quick-date-btn:hover {
      background-color: #E1BEE7;
      border-color: #9C27B0;
      color: #6A1B9A;
    }

    .quick-date-label {
      font-size: 0.85em;
      color: #b8b8bc;
      font-weight: 600;
      display: inline-block;
      margin-right: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* X ë‹«ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .close-button {
      float: right;
      font-size: 1.5em;
      font-weight: 300;
      color: #ffffff;
      cursor: pointer;
      padding: 0 10px;
      line-height: 1;
      transition: all 0.2s ease;
      opacity: 0.8;
    }

    .close-button:hover {
      color: #ff006e;
      opacity: 1;
      transform: rotate(90deg);
    }

    .dashboard-title-with-close {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.02);
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      transition: background 0.3s ease;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 212, 255, 0.3);
    }

    /* ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ */
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }

    @keyframes glow {
      0% { box-shadow: 0 0 5px rgba(0, 212, 255, 0.2); }
      50% { box-shadow: 0 0 20px rgba(0, 212, 255, 0.5), 0 0 30px rgba(0, 212, 255, 0.3); }
      100% { box-shadow: 0 0 5px rgba(0, 212, 255, 0.2); }
    }

    /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }

    /* ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ë§ */
    input[type="checkbox"] {
      margin-right: 8px;
      width: 16px;
      height: 16px;
      accent-color: #00d4ff;
      cursor: pointer;
    }
    label {
      cursor: pointer;
      user-select: none;
      color: #b8b8bc;
      transition: color 0.2s ease;
    }
    label:hover {
      color: #e4e4e7;
    }


    /* ì„ íƒëœ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
    ::selection {
      background: rgba(0, 212, 255, 0.3);
      color: #ffffff;
    }
    ::-moz-selection {
      background: rgba(0, 212, 255, 0.3);
      color: #ffffff;
    }
</head>
<body>
<div class="container">
  <h1><span style="color: #e4e4e7; -webkit-text-fill-color: initial;">ğŸ˜</span> ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ</h1>

  <!-- ë©”ì¸ íƒ­ -->
  <div class="main-tabs">
    <div class="main-tab active" onclick="showMainTab('today')">ğŸŒ ì˜¤ëŠ˜ ì „ì²´</div>
    <div class="main-tab" onclick="showMainTab('last30min')">âš¡ ìµœê·¼ 30ë¶„</div>
    <div class="main-tab" onclick="showMainTab('custom-date')">ğŸ“† ë‚ ì§œ ì§€ì •</div>
    <div class="main-tab" onclick="showMainTab('comparison')">âš”ï¸ ê¸°ê°„ ë¹„êµ</div>
  </div>

  <!-- ì˜¤ëŠ˜ ì „ì²´ íƒ­ ì»¨í…ì¸  -->
  <div id="today-content" class="tab-content active">
    <div class="dashboard-box">
      <div style="display: flex; justify-content: space-between;">
        <!-- ì™¼ìª½ êµ¬ì—­ (ë¹¨ê°„ìƒ‰ ë¶€ë¶„) -->
        <div style="width: 18%;">
          <div class="dashboard-title">ğŸ” ì˜¤ëŠ˜ ì „ì²´ í™œì„± ì‚¬ìš©ì</div>
          <div class="active-users" id="today-active-users">0</div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ êµ¬ì—­ (ì£¼í™©ìƒ‰ ë¶€ë¶„) -->
        <div style="width: 78%;">
          <div class="dashboard-title" style="margin-top: 0;">ğŸ”¢ ì˜¤ëŠ˜ ì „ì²´ ì¡°íšŒìˆ˜</div>
          <div class="active-users" id="today-total-pageviews">0</div>
        </div>
      </div>

      <div class="update-time" id="today-update-time">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</div>
    </div>

    <!-- ì„œë¸Œ íƒ­ (ì˜¤ëŠ˜ ì „ì²´) -->
    <div class="sub-tabs">
      <div class="sub-tab active" onclick="showSubTab('today', 'full')">ğŸ“Š ì „ì²´ ì œëª©</div>
      <div class="sub-tab" onclick="showSubTab('today', 'prefix1')">1ï¸âƒ£ ì ‘ë‘ì–´ (1ë‹¨ì–´)</div>
      <div class="sub-tab" onclick="showSubTab('today', 'prefix2')">2ï¸âƒ£ ì ‘ë‘ì–´ (2ë‹¨ì–´)</div>
      <div class="sub-tab" onclick="showSubTab('today', 'prefix3')">3ï¸âƒ£ ì ‘ë‘ì–´ (3ë‹¨ì–´)</div>
      <div class="sub-tab" onclick="showSubTab('today', 'category')">ğŸ“‘ ì¹´í…Œê³ ë¦¬ë³„</div>
      <button class="sync-button" onclick="syncWordPressCategories(false)">
        <span class="sync-button-icon">ğŸ”„</span> ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ë™ê¸°í™”
      </button>
      <button class="sync-button full-sync-button" onclick="syncWordPressCategories(true)">
        <span class="sync-button-icon">ğŸ”</span> ì¹´í…Œê³ ë¦¬ ì „ì²´ ì´ˆê¸°í™”
      </button>
    </div>

    <!-- ì „ì²´ ì œëª© í…Œì´ë¸” (ì˜¤ëŠ˜) -->
    <div id="today-full-content" class="sub-tab-content active">
      <div class="dashboard-box">
        <div style="display: flex; align-items: center; justify-content: space-between;">
          <div class="dashboard-title">ğŸ“ˆ í˜ì´ì§€ ì œëª©ë³„ ì¡°íšŒìˆ˜ (ì˜¤ëŠ˜)</div>
          <div class="category-filter-container" id="today-full-category-filter">
            <span class="category-label">ì¹´í…Œê³ ë¦¬ ì„ íƒ:</span>
            <select class="category-dropdown" id="today-full-category-select" onchange="filterByCategoryInFullTab('today', this.value)">
              <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
            </select>
          </div>
        </div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>í˜ì´ì§€ ì œëª©</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="today-page-title-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- ì ‘ë‘ì–´ 1ë‹¨ì–´ í…Œì´ë¸” (ì˜¤ëŠ˜) -->
    <div id="today-prefix1-content" class="sub-tab-content">
      <div class="dashboard-box">
        <div class="dashboard-title">ğŸ”¤ ì ‘ë‘ì–´ë³„ ì¡°íšŒìˆ˜ (1ë‹¨ì–´)</div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>ì ‘ë‘ì–´</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="today-prefix1-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- ì ‘ë‘ì–´ 2ë‹¨ì–´ í…Œì´ë¸” (ì˜¤ëŠ˜) -->
    <div id="today-prefix2-content" class="sub-tab-content">
      <div class="dashboard-box">
        <div class="dashboard-title">ğŸ”¤ ì ‘ë‘ì–´ë³„ ì¡°íšŒìˆ˜ (2ë‹¨ì–´)</div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>ì ‘ë‘ì–´</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="today-prefix2-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- ì ‘ë‘ì–´ 3ë‹¨ì–´ í…Œì´ë¸” (ì˜¤ëŠ˜) -->
    <div id="today-prefix3-content" class="sub-tab-content">
      <div class="dashboard-box">
        <div class="dashboard-title">ğŸ”¤ ì ‘ë‘ì–´ë³„ ì¡°íšŒìˆ˜ (3ë‹¨ì–´)</div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>ì ‘ë‘ì–´</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="today-prefix3-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>

    <div id="today-category-content" class="sub-tab-content">
      <div class="dashboard-box">
        <div id="sync-banner-today" class="sync-banner">ğŸ”„ ì•„ì§ ë™ê¸°í™”ëœ ì¹´í…Œê³ ë¦¬ ë°ì´í„°ê°€ ì—†ì–´ìš”! ë™ê¸°í™” ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!</div>
        <div class="dashboard-title">ğŸ“‘ ì¹´í…Œê³ ë¦¬ë³„ ì¡°íšŒìˆ˜ (ì˜¤ëŠ˜)</div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>ì¹´í…Œê³ ë¦¬</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="today-category-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>

  </div>


  <!-- ìµœê·¼ 30ë¶„ íƒ­ ì»¨í…ì¸  -->
  <div id="last30min-content" class="tab-content">
    <div class="dashboard-box">
      <div style="display: flex; justify-content: space-between;">
        <!-- ì™¼ìª½ êµ¬ì—­ -->
        <div style="width: 18%;">
          <div class="dashboard-title">ğŸ”¥ ìµœê·¼ 30ë¶„ í™œì„± ì‚¬ìš©ì</div>
          <div class="active-users" id="last30min-active-users">0</div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ êµ¬ì—­ -->
        <div style="width: 78%;">
          <div class="dashboard-title" style="margin-top: 0;">ğŸ”¢ ìµœê·¼ 30ë¶„ ì „ì²´ ì¡°íšŒìˆ˜</div>
          <div class="active-users" id="last30min-total-pageviews">0</div>
        </div>
      </div>

      <div class="update-time" id="last30min-update-time">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</div>
    </div>

    <!-- ì„œë¸Œ íƒ­ (ìµœê·¼ 30ë¶„) -->
    <div class="sub-tabs">
      <div class="sub-tab active" onclick="showSubTab('last30min', 'full')">ğŸ“Š ì „ì²´ ì œëª©</div>
      <div class="sub-tab" onclick="showSubTab('last30min', 'prefix1')">1ï¸âƒ£ ì ‘ë‘ì–´ (1ë‹¨ì–´)</div>
      <div class="sub-tab" onclick="showSubTab('last30min', 'prefix2')">2ï¸âƒ£ ì ‘ë‘ì–´ (2ë‹¨ì–´)</div>
      <div class="sub-tab" onclick="showSubTab('last30min', 'prefix3')">3ï¸âƒ£ ì ‘ë‘ì–´ (3ë‹¨ì–´)</div>
    </div>

    <!-- ì „ì²´ ì œëª© í…Œì´ë¸” (ìµœê·¼ 30ë¶„) -->
    <div id="last30min-full-content" class="sub-tab-content active">
      <div class="dashboard-box">
        <div class="dashboard-title">ğŸ“ˆ í˜ì´ì§€ ì œëª©ë³„ ì¡°íšŒìˆ˜ (ìµœê·¼ 30ë¶„)</div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>í˜ì´ì§€ ì œëª©</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="last30min-page-title-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- ì ‘ë‘ì–´ 1ë‹¨ì–´ í…Œì´ë¸” (ìµœê·¼ 30ë¶„) -->
    <div id="last30min-prefix1-content" class="sub-tab-content">
      <div class="dashboard-box">
        <div class="dashboard-title">ğŸ”¤ ì ‘ë‘ì–´ë³„ ì¡°íšŒìˆ˜ (1ë‹¨ì–´)</div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>ì ‘ë‘ì–´</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="last30min-prefix1-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- ì ‘ë‘ì–´ 2ë‹¨ì–´ í…Œì´ë¸” (ìµœê·¼ 30ë¶„) -->
    <div id="last30min-prefix2-content" class="sub-tab-content">
      <div class="dashboard-box">
        <div class="dashboard-title">ğŸ”¤ ì ‘ë‘ì–´ë³„ ì¡°íšŒìˆ˜ (2ë‹¨ì–´)</div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>ì ‘ë‘ì–´</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="last30min-prefix2-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- ì ‘ë‘ì–´ 3ë‹¨ì–´ í…Œì´ë¸” (ìµœê·¼ 30ë¶„) -->
    <div id="last30min-prefix3-content" class="sub-tab-content">
      <div class="dashboard-box">
        <div class="dashboard-title">ğŸ”¤ ì ‘ë‘ì–´ë³„ ì¡°íšŒìˆ˜ (3ë‹¨ì–´)</div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>ì ‘ë‘ì–´</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="last30min-prefix3-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ë‚ ì§œ ì§€ì • íƒ­ ì»¨í…ì¸  -->
  <div id="custom-date-content" class="tab-content">
    <div class="dashboard-box">
      <div class="date-selector">
        <input type="date" id="start-date" onchange="validateDates()">
        <span>~</span>
        <input type="date" id="end-date" onchange="validateDates()">
        <button onclick="fetchCustomDateData()" class="fetch-btn">ğŸ” ì¡°íšŒí•˜ê¸°</button>
        <div class="auto-update-check">
          <input type="checkbox" id="auto-update-check">
          <label for="auto-update-check">ì˜¤ëŠ˜ í¬í•¨ì‹œ ìë™ ì—…ë°ì´íŠ¸</label>
        </div>
      </div>

      <!-- ë¹ ë¥¸ ë‚ ì§œ ì„ íƒ ë²„íŠ¼ ì¶”ê°€ -->
      <div style="margin-top: 10px; margin-bottom: 15px;">
        <span class="quick-date-label">ë¹ ë¥¸ ì„ íƒ:</span>
        <div class="quick-date-buttons" style="display: inline-flex; margin-left: 10px;">
          <button class="quick-date-btn" onclick="setCustomDateRange(1)">ì˜¤ëŠ˜</button>
          <button class="quick-date-btn" onclick="setCustomDateRange(3)">3ì¼</button>
          <button class="quick-date-btn" onclick="setCustomDateRange(7)">7ì¼</button>
          <button class="quick-date-btn" onclick="setCustomDateRange(14)">2ì£¼</button>
          <button class="quick-date-btn" onclick="setCustomDateRange(30)">í•œë‹¬</button>
        </div>
        <div style="display: inline-flex; align-items: center; margin-left: 20px;">
          <input type="checkbox" id="custom-date-exclude-today" style="margin-right: 5px;">
          <label for="custom-date-exclude-today" style="font-size: 0.85em; color: #666; cursor: pointer;">
            ğŸ“… ì „ì¼ ê¸°ì¤€ (ì˜¤ëŠ˜ ì œì™¸)
          </label>
        </div>
      </div>

      <div style="display: flex; justify-content: space-between; margin-top: 15px;">
        <!-- ì™¼ìª½ êµ¬ì—­ -->
        <div style="width: 18%;">
          <div class="dashboard-title">ğŸ“… ì§€ì • ê¸°ê°„ í™œì„± ì‚¬ìš©ì</div>
          <div class="active-users" id="custom-date-active-users">0</div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ êµ¬ì—­ -->
        <div style="width: 78%;">
          <div class="dashboard-title" style="margin-top: 0;">ğŸ”¢ ì§€ì • ê¸°ê°„ ì „ì²´ ì¡°íšŒìˆ˜</div>
          <div class="active-users" id="custom-date-total-pageviews">0</div>
        </div>
      </div>

      <div class="update-time" id="custom-date-update-time">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</div>
    </div>

    <!-- ì„œë¸Œ íƒ­ (ë‚ ì§œ ì§€ì •) -->
    <div class="sub-tabs">
      <div class="sub-tab active" onclick="showSubTab('custom-date', 'full')">ğŸ“Š ì „ì²´ ì œëª©</div>
      <div class="sub-tab" onclick="showSubTab('custom-date', 'prefix1')">1ï¸âƒ£ ì ‘ë‘ì–´ (1ë‹¨ì–´)</div>
      <div class="sub-tab" onclick="showSubTab('custom-date', 'prefix2')">2ï¸âƒ£ ì ‘ë‘ì–´ (2ë‹¨ì–´)</div>
      <div class="sub-tab" onclick="showSubTab('custom-date', 'prefix3')">3ï¸âƒ£ ì ‘ë‘ì–´ (3ë‹¨ì–´)</div>
      <div class="sub-tab" onclick="showSubTab('custom-date', 'category')">ğŸ“‘ ì¹´í…Œê³ ë¦¬ë³„</div>
    </div>

    <!-- ì „ì²´ ì œëª© í…Œì´ë¸” (ë‚ ì§œ ì§€ì •) -->
    <div id="custom-date-full-content" class="sub-tab-content active">
      <div class="dashboard-box">
        <div style="display: flex; align-items: center; justify-content: space-between;">
          <div class="dashboard-title">ğŸ“ˆ í˜ì´ì§€ ì œëª©ë³„ ì¡°íšŒìˆ˜ (ì§€ì • ê¸°ê°„)</div>
          <div class="category-filter-container" id="custom-date-full-category-filter">
            <span class="category-label">ì¹´í…Œê³ ë¦¬ ì„ íƒ:</span>
            <select class="category-dropdown" id="custom-date-full-category-select" onchange="filterByCategoryInFullTab('custom-date', this.value)">
              <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
            </select>
          </div>
        </div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>í˜ì´ì§€ ì œëª©</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="custom-date-page-title-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- ì ‘ë‘ì–´ 1ë‹¨ì–´ í…Œì´ë¸” (ë‚ ì§œ ì§€ì •) -->
    <div id="custom-date-prefix1-content" class="sub-tab-content">
      <div class="dashboard-box">
        <div class="dashboard-title">ğŸ”¤ ì ‘ë‘ì–´ë³„ ì¡°íšŒìˆ˜ (1ë‹¨ì–´)</div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>ì ‘ë‘ì–´</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="custom-date-prefix1-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- ì ‘ë‘ì–´ 2ë‹¨ì–´ í…Œì´ë¸” (ë‚ ì§œ ì§€ì •) -->
    <div id="custom-date-prefix2-content" class="sub-tab-content">
      <div class="dashboard-box">
        <div class="dashboard-title">ğŸ”¤ ì ‘ë‘ì–´ë³„ ì¡°íšŒìˆ˜ (2ë‹¨ì–´)</div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>ì ‘ë‘ì–´</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="custom-date-prefix2-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- ì ‘ë‘ì–´ 3ë‹¨ì–´ í…Œì´ë¸” (ë‚ ì§œ ì§€ì •) -->
    <div id="custom-date-prefix3-content" class="sub-tab-content">
      <div class="dashboard-box">
        <div class="dashboard-title">ğŸ”¤ ì ‘ë‘ì–´ë³„ ì¡°íšŒìˆ˜ (3ë‹¨ì–´)</div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>ì ‘ë‘ì–´</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="custom-date-prefix3-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ë³„ í…Œì´ë¸” (ë‚ ì§œ ì§€ì •) ì¶”ê°€ -->
    <div id="custom-date-category-content" class="sub-tab-content">
      <div class="dashboard-box">
        <div id="sync-banner-custom-date" class="sync-banner">ğŸ”„ ì•„ì§ ë™ê¸°í™”ëœ ì¹´í…Œê³ ë¦¬ ë°ì´í„°ê°€ ì—†ì–´ìš”! ë™ê¸°í™” ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!</div>
        <div class="dashboard-title">ğŸ“‘ ì¹´í…Œê³ ë¦¬ë³„ ì¡°íšŒìˆ˜ (ì§€ì • ê¸°ê°„)</div>
        <table>
          <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>ì¹´í…Œê³ ë¦¬</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
          </thead>
          <tbody id="custom-date-category-views">
          <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>

  </div>

  <!-- ê¸°ê°„ ë¹„êµ íƒ­ ì»¨í…ì¸  -->
  <div id="comparison-content" class="tab-content">
      <div class="dashboard-box">
        <div class="dashboard-title"><span style="color: #e4e4e7; -webkit-text-fill-color: initial;">âš”ï¸</span> ê¸°ê°„ ë¹„êµ ë¶„ì„</div>
        <div style="font-size: 0.9em; color: #666; margin-top: 5px; margin-bottom: 15px;">
          ğŸ“Œ ê¸°ê°„ A(ì´ì „)ì—ì„œ ê¸°ê°„ B(ìµœê·¼)ë¡œì˜ ë³€í™”ë¥¼ ë¶„ì„í•´ìš”! ìƒìŠ¹/í•˜ë½ íŠ¸ë Œë“œë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.
        </div>
        
        <!-- ê¸°ê°„ ì„ íƒ UI -->
        <div class="period-comparison-container">
          <div class="period-box period-a">
            <div class="period-title">ğŸ“… ê¸°ê°„ A (ì´ì „)</div>
            <input type="date" id="period-a-start" onchange="validatePeriodDates('a')">
            <span>~</span>
            <input type="date" id="period-a-end" onchange="validatePeriodDates('a')">
          </div>
          
          <div class="vs-symbol">âš”ï¸</div>
          
          <div class="period-box period-b">
            <div class="period-title">ğŸ“… ê¸°ê°„ B (ìµœê·¼)</div>
            <input type="date" id="period-b-start" onchange="validatePeriodDates('b')">
            <span>~</span>
            <input type="date" id="period-b-end" onchange="validatePeriodDates('b')">
          </div>
          
          <button onclick="fetchComparisonData()" class="compare-btn">ğŸ” ë¹„êµí•˜ê¸°</button>
        </div>

        <!-- ë¹ ë¥¸ ë‚ ì§œ ì„ íƒ ë²„íŠ¼ -->
        <div style="margin-top: 15px; margin-bottom: 20px;">
          <span class="quick-date-label">ë¹ ë¥¸ ì„ íƒ:</span>
          <div class="quick-date-buttons" style="display: inline-flex; margin-left: 10px;">
            <button class="quick-date-btn" onclick="setQuickDateRange(1)">ì˜¤ëŠ˜</button>
            <button class="quick-date-btn" onclick="setQuickDateRange(3)">3ì¼</button>
            <button class="quick-date-btn" onclick="setQuickDateRange(7)">7ì¼</button>
            <button class="quick-date-btn" onclick="setQuickDateRange(14)">2ì£¼</button>
            <button class="quick-date-btn" onclick="setQuickDateRange(30)">í•œë‹¬</button>
          </div>
          <div style="display: inline-flex; align-items: center; margin-left: 20px;">
            <input type="checkbox" id="exclude-today-check" style="margin-right: 5px;" checked>
            <label for="exclude-today-check" style="font-size: 0.85em; color: #666; cursor: pointer;">
              ğŸ“… ì „ì¼ ê¸°ì¤€ (ì˜¤ëŠ˜ ì œì™¸)
            </label>
          </div>
        </div>

        <!-- ìŠ¤ë§ˆíŠ¸ í•„í„° -->
        <div class="smart-filter" id="comparison-filters">
          <button class="filter-btn active" onclick="applyComparisonFilter('all')">ì „ì²´ ë³´ê¸°</button>
          <button class="filter-btn" onclick="applyComparisonFilter('top-increase')">ğŸ”¥ TOP 25 ìƒìŠ¹</button>
          <button class="filter-btn" onclick="applyComparisonFilter('top-decrease')">ğŸ’§ TOP 25 í•˜ë½</button>
          <button class="filter-btn" onclick="applyComparisonFilter('rapid-growth')">ğŸš€ ê¸‰ìƒìŠ¹ (100%â†‘)</button>
        </div>

        <!-- ì¹´í…Œê³ ë¦¬ë³„ ë¹„êµ í…Œì´ë¸” -->
        <div class="dashboard-box" style="margin-top: 20px;">
          <div class="dashboard-title">ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ ë¹„êµ</div>
          <table>
            <thead>
            <tr>
              <th>ìˆœë²ˆ</th>
              <th>ì¹´í…Œê³ ë¦¬</th>
              <th>ê¸°ê°„ A</th>
              <th>ê¸°ê°„ B</th>
              <th>ë³€í™”ëŸ‰</th>
              <th>ë³€í™”ìœ¨</th>
              <th>ê¸°ê°„ A ë¹„ì¤‘</th>
              <th>ê¸°ê°„ B ë¹„ì¤‘</th>
            </tr>
            </thead>
            <tbody id="comparison-category-table">
            <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
            </tbody>
          </table>
        </div>

        <!-- ìƒì„¸ í¬ìŠ¤íŠ¸ ë¹„êµ (ì¹´í…Œê³ ë¦¬ í´ë¦­ì‹œ í‘œì‹œ) -->
        <div id="comparison-post-detail" class="dashboard-box" style="margin-top: 20px; display: none;">
          <div class="dashboard-title-with-close">
            <div class="dashboard-title" id="comparison-post-detail-title">ğŸ“ˆ í¬ìŠ¤íŠ¸ë³„ ìƒì„¸ ë¹„êµ</div>
            <span class="close-button" onclick="closeComparisonDetail()">Ã—</span>
          </div>
          <table>
            <thead>
            <tr>
              <th>ìˆœë²ˆ</th>
              <th>í¬ìŠ¤íŠ¸ ì œëª©</th>
              <th>ê¸°ê°„ A</th>
              <th>ê¸°ê°„ B</th>
              <th>ë³€í™”ëŸ‰</th>
              <th>ë³€í™”ìœ¨</th>
            </tr>
            </thead>
            <tbody id="comparison-post-table">
            <!-- ì—¬ê¸°ì— ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  let todayIntervalId = null;
  let last30minIntervalId = null;
  let wpCategoryData = null; // ì›Œë“œí”„ë ˆìŠ¤ ì¹´í…Œê³ ë¦¬ ë°ì´í„° ì €ì¥
  let currentPageViewsData = {}; // í˜„ì¬ í˜ì´ì§€ë·° ë°ì´í„° ì €ì¥

  // í˜ì´ì§€ ë¡œë“œì‹œ ì²˜ìŒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  document.addEventListener('DOMContentLoaded', function() {
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²« ë²ˆì§¸ íƒ­(ì˜¤ëŠ˜ ì „ì²´) í™œì„±í™”
    fetchTodayData();
    startTodayInterval();

    // ë‚ ì§œ ì„ íƒê¸° ì´ˆê¸°í™” (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
    const now = new Date();
    const today = now.getFullYear() + '-' +
        String(now.getMonth() + 1).padStart(2, '0') + '-' +
        String(now.getDate()).padStart(2, '0');

    document.getElementById('start-date').value = today;
    document.getElementById('end-date').value = today;

    document.getElementById('auto-update-check').addEventListener('change', function() {
      if (this.checked && document.getElementById('end-date').value === today) {
        fetchCustomDateData();
      }
    });

    // ë™ê¸°í™” ìƒíƒœ í™•ì¸
    checkSyncStatus();
    
    // ì›Œë“œí”„ë ˆìŠ¤ ì¹´í…Œê³ ë¦¬ ë°ì´í„° ë¡œë“œ
    loadWpCategoryData();
  });

  // ì˜¤ëŠ˜ ë°ì´í„° ì¸í„°ë²Œ ì‹œì‘ í•¨ìˆ˜
  function startTodayInterval() {
    if (todayIntervalId === null) {
      todayIntervalId = setInterval(fetchTodayData, 30000); // 30ì´ˆë¡œ ë³€ê²½!
    }
  }

  // ì˜¤ëŠ˜ ë°ì´í„° ì¸í„°ë²Œ ì¤‘ì§€ í•¨ìˆ˜
  function stopTodayInterval() {
    if (todayIntervalId !== null) {
      clearInterval(todayIntervalId);
      todayIntervalId = null;
    }
  }

  // ìµœê·¼ 30ë¶„ ë°ì´í„° ì¸í„°ë²Œ ì‹œì‘ í•¨ìˆ˜
  function startLast30minInterval() {
    if (last30minIntervalId === null) {
      fetchLast30MinData(); // ë¨¼ì € í•œ ë²ˆ í˜¸ì¶œ
      last30minIntervalId = setInterval(fetchLast30MinData, 30000); // 30ì´ˆë¡œ ë³€ê²½!
    }
  }

  // ìµœê·¼ 30ë¶„ ë°ì´í„° ì¸í„°ë²Œ ì¤‘ì§€ í•¨ìˆ˜
  function stopLast30minInterval() {
    if (last30minIntervalId !== null) {
      clearInterval(last30minIntervalId);
      last30minIntervalId = null;
    }
  }

  // ë™ê¸°í™” ìƒíƒœ í™•ì¸ í•¨ìˆ˜
  function checkSyncStatus() {
    fetch('/api/realtime-pageviews')
    .then(response => response.json())
    .then(data => {
      const hasCategories = data.categoryViews && Object.keys(data.categoryViews).length > 0;

      // ê° íƒ­ì˜ ë°°ë„ˆ í‘œì‹œ/ìˆ¨ê¹€ ì„¤ì •
      const todayBanner = document.getElementById('sync-banner-today');
      const customDateBanner = document.getElementById('sync-banner-custom-date');
      
      if (todayBanner) {
        todayBanner.classList.toggle('visible', !hasCategories);
      }
      // last30min íƒ­ì—ëŠ” ì¹´í…Œê³ ë¦¬ ê¸°ëŠ¥ì´ ì—†ìœ¼ë¯€ë¡œ ì œê±°
      if (customDateBanner) {
        customDateBanner.classList.toggle('visible', !hasCategories);
      }
    })
    .catch(error => console.error('ë™ê¸°í™” ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error));
  }

  // ì¹´í…Œê³ ë¦¬ë³„ ì¡°íšŒìˆ˜ í…Œì´ë¸” ì—…ë°ì´íŠ¸
  function updateCategoryViewsTable(categoryViews, tableId) {
    const tableBody = document.getElementById(tableId);
    tableBody.innerHTML = '';

    // ë™ê¸°í™” ë°°ë„ˆ í‘œì‹œ ì—¬ë¶€ ì„¤ì •
    const mainTab = tableId.split('-')[0]; // "today", "last30min" ë˜ëŠ” "custom-date" ì¶”ì¶œ
    const bannerId = "sync-banner-" + mainTab;
    const syncBanner = document.getElementById(bannerId);

    if (!categoryViews || Object.keys(categoryViews).length === 0) {
      if (syncBanner) {
        syncBanner.classList.add('visible');
      } else {
        console.warn(`ì°¾ì„ ìˆ˜ ì—†ëŠ” ë°°ë„ˆì•¼! ID: "${bannerId}"`);
      }

      const row = document.createElement('tr');
      const cell = document.createElement('td');
      cell.setAttribute('colspan', '3');
      cell.textContent = 'ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ì•„ì§ ì¹´í…Œê³ ë¦¬ê°€ ë™ê¸°í™”ë˜ì§€ ì•Šì•˜ì–´ìš”! ğŸ¥º';
      cell.style.textAlign = 'center';
      row.appendChild(cell);
      tableBody.appendChild(row);
      return;
    }

    // ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë°°ë„ˆ ìˆ¨ê¸°ê¸°
    if (syncBanner) {
      syncBanner.classList.remove('visible');
    }

    // ì¹´í…Œê³ ë¦¬ë³„ í¬ìŠ¤íŠ¸ ê°œìˆ˜ ê³„ì‚°
    const categoryPostCounts = {};
    if (wpCategoryData && wpCategoryData.posts && wpCategoryData.categories) {
      // ê° í¬ìŠ¤íŠ¸ê°€ ì†í•œ ì¹´í…Œê³ ë¦¬ë¥¼ ìˆœíšŒí•˜ë©´ì„œ ì¹´ìš´íŠ¸
      Object.entries(wpCategoryData.posts).forEach(([postId, categoryIds]) => {
        if (categoryIds && Array.isArray(categoryIds)) {
          categoryIds.forEach(catId => {
            const categoryName = wpCategoryData.categories[catId];
            if (categoryName) {
              categoryPostCounts[categoryName] = (categoryPostCounts[categoryName] || 0) + 1;
            }
          });
        }
      });
    }

    // ì´ ì¡°íšŒìˆ˜ ê³„ì‚°
    const totalViews = Object.values(categoryViews).reduce((sum, views) => sum + views, 0);

    // ë°°ì—´ë¡œ ë³€í™˜í•˜ì—¬ ì •ë ¬ (ì¡°íšŒìˆ˜ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
    const sortedCategories = Object.entries(categoryViews)
    .sort((a, b) => b[1] - a[1]);

    // í…Œì´ë¸”ì— ë°ì´í„° ì¶”ê°€
    sortedCategories.forEach(([category, views], index) => {
      const row = document.createElement('tr');

      // ìˆœë²ˆ ì…€
      const numCell = document.createElement('td');
      numCell.textContent = index + 1; // 1ë¶€í„° ì‹œì‘í•˜ëŠ” ìˆœë²ˆ
      row.appendChild(numCell);

      // ì¹´í…Œê³ ë¦¬ ì…€ (í¬ìŠ¤íŠ¸ ê°œìˆ˜ í¬í•¨)
      const categoryCell = document.createElement('td');
      const postCount = categoryPostCounts[category] || 0;
      categoryCell.textContent = `${category} (${postCount})`;
      row.appendChild(categoryCell);

      // ì¡°íšŒìˆ˜ ì…€
      const viewsCell = document.createElement('td');
      viewsCell.textContent = Math.round(views);
      row.appendChild(viewsCell);

      // ë¹„ìœ¨ ì…€ (í”„ë¡œê·¸ë ˆìŠ¤ ë°”)
      const ratioCell = document.createElement('td');
      const percentage = totalViews > 0 ? (views / totalViews * 100) : 0;

      const progressContainer = document.createElement('div');
      progressContainer.style.display = 'flex';
      progressContainer.style.alignItems = 'center';

      const progressBar = document.createElement('div');
      progressBar.className = 'progress-bar';
      progressBar.style.width = '100px';

      const progressValue = document.createElement('div');
      progressValue.className = 'progress-value';
      progressValue.style.width = `${percentage}%`;
      progressValue.style.background = 'linear-gradient(90deg, #b794f6 0%, #9f7aea 100%)'; // ì¹´í…Œê³ ë¦¬ëŠ” ë³´ë¼ìƒ‰ ê·¸ë¼ë””ì–¸íŠ¸

      const percentText = document.createElement('span');
      percentText.textContent = `${percentage.toFixed(1)}%`;

      progressBar.appendChild(progressValue);
      progressContainer.appendChild(progressBar);
      progressContainer.appendChild(percentText);
      ratioCell.appendChild(progressContainer);

      row.appendChild(ratioCell);
      tableBody.appendChild(row);
    });
  }

  // ë©”ì¸ íƒ­ ì „í™˜ í•¨ìˆ˜
  function showMainTab(tabName) {
    // ëª¨ë“  ë©”ì¸ íƒ­ê³¼ íƒ­ ì»¨í…ì¸ ë¥¼ ë¹„í™œì„±í™”
    document.querySelectorAll('.main-tab').forEach(tab => {
      tab.classList.remove('active');
    });
    document.querySelectorAll('.tab-content').forEach(content => {
      content.classList.remove('active');
    });

    // ì¼ë‹¨ ëª¨ë“  ì¸í„°ë²Œ ì¤‘ì§€
    stopTodayInterval();
    stopLast30minInterval();

    // ì„ íƒí•œ ë©”ì¸ íƒ­ê³¼ í•´ë‹¹ ì»¨í…ì¸ ë¥¼ í™œì„±í™”
    if (tabName === 'today') {
      document.querySelector('.main-tab:nth-child(1)').classList.add('active');
      document.getElementById('today-content').classList.add('active');
      fetchTodayData(); // íƒ­ ì „í™˜ ì‹œ ì¦‰ì‹œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      startTodayInterval(); // ì˜¤ëŠ˜ ë°ì´í„°ë§Œ ì£¼ê¸°ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
    } else if (tabName === 'last30min') {
      document.querySelector('.main-tab:nth-child(2)').classList.add('active');
      document.getElementById('last30min-content').classList.add('active');
      startLast30minInterval(); // ìµœê·¼ 30ë¶„ ë°ì´í„°ë§Œ ì£¼ê¸°ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
    } else if (tabName === 'custom-date') {
      document.querySelector('.main-tab:nth-child(3)').classList.add('active');
      document.getElementById('custom-date-content').classList.add('active');

      // ì˜¤ëŠ˜ í¬í•¨ì‹œ ìë™ ì—…ë°ì´íŠ¸
      const autoUpdateCheck = document.getElementById('auto-update-check');
      if (autoUpdateCheck && autoUpdateCheck.checked) {
        const endDate = document.getElementById('end-date').value;
        const now = new Date();
        const today = now.getFullYear() + '-' +
            String(now.getMonth() + 1).padStart(2, '0') + '-' +
            String(now.getDate()).padStart(2, '0');

        if (endDate === today) {
          // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
          fetchCustomDateData();
          // 30ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸
          customDateIntervalId = setInterval(fetchCustomDateData, 30000);
        }
      }
    } else if (tabName === 'comparison') {
      document.querySelector('.main-tab:nth-child(4)').classList.add('active');
      document.getElementById('comparison-content').classList.add('active');
    }
  }

  // ì„œë¸Œ íƒ­ ì „í™˜ í•¨ìˆ˜
  function showSubTab(mainTab, subTab) {
    // í•´ë‹¹ ë©”ì¸ íƒ­ ë‚´ì˜ ëª¨ë“  ì„œë¸Œ íƒ­ê³¼ ì„œë¸Œ íƒ­ ì»¨í…ì¸ ë¥¼ ë¹„í™œì„±í™”
    const subTabs = document.querySelectorAll(`#${mainTab}-content .sub-tab`);
    const subContents = document.querySelectorAll(`#${mainTab}-content .sub-tab-content`);

    subTabs.forEach(tab => {
      tab.classList.remove('active');
    });
    subContents.forEach(content => {
      content.classList.remove('active');
    });

    // ì„ íƒí•œ ì„œë¸Œ íƒ­ í™œì„±í™” (indexOfë¡œ ì°¾ê¸°)
    const tabTypes = ['full', 'prefix1', 'prefix2', 'prefix3', 'category'];
    const tabIndex = tabTypes.indexOf(subTab);
    if (tabIndex >= 0) {
      subTabs[tabIndex].classList.add('active');
      document.getElementById(`${mainTab}-${subTab}-content`).classList.add('active');
    }
    
    // ì „ì²´ ì œëª© íƒ­ì˜ ì¹´í…Œê³ ë¦¬ í•„í„° ë“œë¡­ë‹¤ìš´ í‘œì‹œ/ìˆ¨ê¹€
    const fullCategoryFilter = document.getElementById(`${mainTab}-full-category-filter`);
    if (fullCategoryFilter) {
      if (subTab === 'full') {
        fullCategoryFilter.classList.add('visible');
      } else {
        fullCategoryFilter.classList.remove('visible');
      }
    }
  }

  function fetchTodayData() {
    fetch('/api/realtime-pageviews')
    .then(response => response.json())
    .then(data => {
      // ë°ì´í„° ì €ì¥
      currentPageViewsData.today = data.pageViews;
      
      // í™œì„± ì‚¬ìš©ì ë° ì „ì²´ í˜ì´ì§€ë·° ì—…ë°ì´íŠ¸
      document.getElementById('today-active-users').textContent = data.activeUsers;

      // ì „ì²´ ì¡°íšŒìˆ˜ ê³„ì‚° ë° í‘œì‹œ
      const totalPageViews = data.pageViews.reduce((sum, item) => sum + item.pageViews, 0);
      document.getElementById('today-total-pageviews').textContent = Math.round(totalPageViews);

      updateTime('today-update-time');

      // í˜„ì¬ í™œì„±í™”ëœ ì„œë¸Œíƒ­ í™•ì¸
      const activeSubTab = document.querySelector('#today-content .sub-tab.active');
      const isFullTabActive = activeSubTab && activeSubTab.textContent.includes('ì „ì²´ ì œëª©');
      
      // ì¹´í…Œê³ ë¦¬ í•„í„° ìƒíƒœ í™•ì¸
      const selectedCategory = document.getElementById('today-full-category-select')?.value;
      
      // ì „ì²´ ì œëª© íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆê³  ì¹´í…Œê³ ë¦¬ê°€ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ í•„í„°ë§ëœ ë°ì´í„° í‘œì‹œ
      if (isFullTabActive && selectedCategory) {
        // í•„í„°ë§ ì ìš©
        filterByCategoryInFullTab('today', selectedCategory);
      } else {
        // í•„í„°ë§ì´ ì—†ìœ¼ë©´ ì „ì²´ ë°ì´í„° í‘œì‹œ
        updatePageViewsTable(data.pageViews, 'today-page-title-views');
      }

      // ì ‘ë‘ì–´ë³„ í…Œì´ë¸” ì—…ë°ì´íŠ¸
      updatePrefixViewsTable(data.pageViews, 'today-prefix1-views', 1);
      updatePrefixViewsTable(data.pageViews, 'today-prefix2-views', 2);
      updatePrefixViewsTable(data.pageViews, 'today-prefix3-views', 3);

      // ì¹´í…Œê³ ë¦¬ë³„ í…Œì´ë¸” ì—…ë°ì´íŠ¸
      updateCategoryViewsTable(data.categoryViews, 'today-category-views');
    })
    .catch(error => console.error('ì˜¤ëŠ˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error));
  }

  function fetchLast30MinData() {
    fetch('/api/last30min-pageviews')
    .then(response => response.json())
    .then(data => {
      // í™œì„± ì‚¬ìš©ì ë° ì „ì²´ í˜ì´ì§€ë·° ì—…ë°ì´íŠ¸
      document.getElementById('last30min-active-users').textContent = data.activeUsers;

      // ì „ì²´ ì¡°íšŒìˆ˜ ê³„ì‚° ë° í‘œì‹œ
      const totalPageViews = data.pageViews.reduce((sum, item) => sum + item.pageViews, 0);
      document.getElementById('last30min-total-pageviews').textContent = Math.round(totalPageViews);

      updateTime('last30min-update-time');

      // ì „ì²´ í…Œì´ë¸” ì—…ë°ì´íŠ¸
      updatePageViewsTable(data.pageViews, 'last30min-page-title-views');

      // ì ‘ë‘ì–´ë³„ í…Œì´ë¸” ì—…ë°ì´íŠ¸
      updatePrefixViewsTable(data.pageViews, 'last30min-prefix1-views', 1);
      updatePrefixViewsTable(data.pageViews, 'last30min-prefix2-views', 2);
      updatePrefixViewsTable(data.pageViews, 'last30min-prefix3-views', 3);
    })
    .catch(error => console.error('ìµœê·¼ 30ë¶„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error));
  }

  // ì „ì²´ í˜ì´ì§€ ì œëª©ë³„ ì¡°íšŒìˆ˜ í…Œì´ë¸” ì—…ë°ì´íŠ¸
  function updatePageViewsTable(data, tableId) {
    const tableBody = document.getElementById(tableId);
    tableBody.innerHTML = '';

    // ì´ ì¡°íšŒìˆ˜ ê³„ì‚°
    const totalViews = data.reduce((sum, item) => sum + item.pageViews, 0);

    // ë°ì´í„° ì •ë ¬ (ì¡°íšŒìˆ˜ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
    data.sort((a, b) => b.pageViews - a.pageViews);

    // í…Œì´ë¸”ì— ë°ì´í„° ì¶”ê°€
    data.forEach((item, index) => {
      const row = document.createElement('tr');

      // ìˆœë²ˆ ì…€
      const numCell = document.createElement('td');
      numCell.textContent = index + 1;  // 1ë¶€í„° ì‹œì‘!
      row.appendChild(numCell);

      // í˜ì´ì§€ ì œëª© ì…€
      const titleCell = document.createElement('td');
      titleCell.textContent = item.pageTitle || '(ì œëª© ì—†ìŒ)';
      row.appendChild(titleCell);

      // ì¡°íšŒìˆ˜ ì…€
      const viewsCell = document.createElement('td');
      viewsCell.textContent = Math.round(item.pageViews);
      row.appendChild(viewsCell);

      // ë¹„ìœ¨ ì…€ (í”„ë¡œê·¸ë ˆìŠ¤ ë°”)
      const ratioCell = document.createElement('td');
      const percentage = totalViews > 0 ? (item.pageViews / totalViews * 100) : 0;

      const progressContainer = document.createElement('div');
      progressContainer.style.display = 'flex';
      progressContainer.style.alignItems = 'center';

      const progressBar = document.createElement('div');
      progressBar.className = 'progress-bar';
      progressBar.style.width = '100px';

      const progressValue = document.createElement('div');
      progressValue.className = 'progress-value';
      progressValue.style.width = `${percentage}%`;

      const percentText = document.createElement('span');
      percentText.textContent = `${percentage.toFixed(1)}%`;

      progressBar.appendChild(progressValue);
      progressContainer.appendChild(progressBar);
      progressContainer.appendChild(percentText);
      ratioCell.appendChild(progressContainer);

      row.appendChild(ratioCell);
      tableBody.appendChild(row);
    });
  }

  // ì ‘ë‘ì–´(Prefix)ë³„ ì¡°íšŒìˆ˜ í…Œì´ë¸” ì—…ë°ì´íŠ¸
  function updatePrefixViewsTable(data, tableId, wordCount) {
    const tableBody = document.getElementById(tableId);
    tableBody.innerHTML = '';

    // í˜ì´ì§€ ì œëª©ì„ ì ‘ë‘ì–´ë¡œ ê·¸ë£¹í™”
    const prefixGroups = groupByPrefix(data, wordCount);

    // ì´ ì¡°íšŒìˆ˜ ê³„ì‚°
    const totalViews = data.reduce((sum, item) => sum + item.pageViews, 0);

    // ì •ë ¬ëœ ì ‘ë‘ì–´ ë°°ì—´ (ì¡°íšŒìˆ˜ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
    const sortedPrefixes = Object.keys(prefixGroups).sort((a, b) => {
      const sumA = prefixGroups[a].reduce((sum, item) => sum + item.pageViews, 0);
      const sumB = prefixGroups[b].reduce((sum, item) => sum + item.pageViews, 0);
      return sumB - sumA;
    });

    // í…Œì´ë¸”ì— ë°ì´í„° ì¶”ê°€
    sortedPrefixes.forEach((prefix, index) => {
      const items = prefixGroups[prefix];
      const prefixTotalViews = items.reduce((sum, item) => sum + item.pageViews, 0);

      const row = document.createElement('tr');

      // ìˆœë²ˆ ì…€ ì¶”ê°€
      const numCell = document.createElement('td');
      numCell.textContent = index + 1;  // 1ë¶€í„° ì‹œì‘!
      row.appendChild(numCell);

      // ì ‘ë‘ì–´ ì…€
      const prefixCell = document.createElement('td');
      prefixCell.textContent = prefix;
      row.appendChild(prefixCell);

      // ì¡°íšŒìˆ˜ ì…€
      const viewsCell = document.createElement('td');
      viewsCell.textContent = Math.round(prefixTotalViews);
      row.appendChild(viewsCell);

      // ë¹„ìœ¨ ì…€ (í”„ë¡œê·¸ë ˆìŠ¤ ë°”)
      const ratioCell = document.createElement('td');
      const percentage = totalViews > 0 ? (prefixTotalViews / totalViews * 100) : 0;

      const progressContainer = document.createElement('div');
      progressContainer.style.display = 'flex';
      progressContainer.style.alignItems = 'center';

      const progressBar = document.createElement('div');
      progressBar.className = 'progress-bar';
      progressBar.style.width = '100px';

      const progressValue = document.createElement('div');
      progressValue.className = 'progress-value';
      progressValue.style.width = `${percentage}%`;

      const percentText = document.createElement('span');
      percentText.textContent = `${percentage.toFixed(1)}%`;

      progressBar.appendChild(progressValue);
      progressContainer.appendChild(progressBar);
      progressContainer.appendChild(percentText);
      ratioCell.appendChild(progressContainer);

      row.appendChild(ratioCell);
      tableBody.appendChild(row);
    });
  }

  // í˜ì´ì§€ ì œëª©ì„ ì ‘ë‘ì–´ë¡œ ê·¸ë£¹í™”í•˜ëŠ” í•¨ìˆ˜
  function groupByPrefix(data, wordCount) {
    const groups = {};

    data.forEach(item => {
      const title = (item.pageTitle || '(ì œëª© ì—†ìŒ)').toLowerCase();
      const words = title.split(' ');

      let prefix;
      if (wordCount === 1) {
        prefix = words.length > 0 ? words[0] : '';
      } else if (words.length >= wordCount) {
        prefix = words.slice(0, wordCount).join(' ');
      } else {
        prefix = title; // ë‹¨ì–´ ìˆ˜ê°€ ë¶€ì¡±í•œ ê²½ìš° ì „ì²´ ì œëª©ì„ ì‚¬ìš©
      }

      if (prefix) {
        if (!groups[prefix]) {
          groups[prefix] = [];
        }
        groups[prefix].push(item);
      }
    });

    return groups;
  }

  function updateTime(elementId) {
    const now = new Date();
    const timeString = now.toLocaleTimeString();
    document.getElementById(elementId).textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${timeString}`;
  }

  // ë‚ ì§œ ìœ íš¨ì„± ê²€ì‚¬
  function validateDates() {
    const startDate = document.getElementById('start-date').value;
    const endDate = document.getElementById('end-date').value;

    if (startDate && endDate && new Date(startDate) > new Date(endDate)) {
      alert('ğŸš¨ ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ì„ ìˆ˜ ì—†ì–´ìš”!');
      document.getElementById('end-date').value = startDate;
    }
  }

  // ë‚ ì§œ ì§€ì • ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  function fetchCustomDateData() {
    const startDate = document.getElementById('start-date').value;
    const endDate = document.getElementById('end-date').value;

    if (!startDate || !endDate) {
      alert('â“ ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”!');
      return;
    }

    // API ìš”ì²­
    fetch(`/api/custom-date-pageviews?startDate=${startDate}&endDate=${endDate}`)
    .then(response => response.json())
    .then(data => {
      // ë°ì´í„° ì €ì¥
      currentPageViewsData.customDate = data.pageViews;
      
      // í™œì„± ì‚¬ìš©ì ì—…ë°ì´íŠ¸
      document.getElementById('custom-date-active-users').textContent = data.activeUsers;

      // ì „ì²´ ì¡°íšŒìˆ˜ ê³„ì‚° ë° í‘œì‹œ
      const totalPageViews = data.pageViews.reduce((sum, item) => sum + item.pageViews, 0);
      document.getElementById('custom-date-total-pageviews').textContent = Math.round(totalPageViews);

      updateTime('custom-date-update-time');

      // í˜„ì¬ í™œì„±í™”ëœ ì„œë¸Œíƒ­ í™•ì¸
      const activeSubTab = document.querySelector('#custom-date-content .sub-tab.active');
      const isFullTabActive = activeSubTab && activeSubTab.textContent.includes('ì „ì²´ ì œëª©');
      
      // ì¹´í…Œê³ ë¦¬ í•„í„° ìƒíƒœ í™•ì¸
      const selectedCategory = document.getElementById('custom-date-full-category-select')?.value;
      
      // ì „ì²´ ì œëª© íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆê³  ì¹´í…Œê³ ë¦¬ê°€ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ í•„í„°ë§ëœ ë°ì´í„° í‘œì‹œ
      if (isFullTabActive && selectedCategory) {
        // í•„í„°ë§ ì ìš©
        filterByCategoryInFullTab('custom-date', selectedCategory);
      } else {
        // í•„í„°ë§ì´ ì—†ìœ¼ë©´ ì „ì²´ ë°ì´í„° í‘œì‹œ
        updatePageViewsTable(data.pageViews, 'custom-date-page-title-views');
      }
      
      // ì ‘ë‘ì–´ë³„ í…Œì´ë¸” ì—…ë°ì´íŠ¸
      updatePrefixViewsTable(data.pageViews, 'custom-date-prefix1-views', 1);
      updatePrefixViewsTable(data.pageViews, 'custom-date-prefix2-views', 2);
      updatePrefixViewsTable(data.pageViews, 'custom-date-prefix3-views', 3);

      // ì¹´í…Œê³ ë¦¬ë³„ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì¶”ê°€
      updateCategoryViewsTable(data.categoryViews, 'custom-date-category-views');
    })
    .catch(error => console.error('ë‚ ì§œ ì§€ì • ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error));
  }

  // ìë™ ì—…ë°ì´íŠ¸ ì„¤ì •
  let customDateInterval;
  function setupAutoUpdate() {

    console.log('setupAutoUpdate í˜¸ì¶œë¨(ì‚¬ìš© ì•ˆí•¨)');
    // ê¸°ì¡´ ì¸í„°ë²Œ ì œê±°
    if (customDateInterval) {
      clearInterval(customDateInterval);
    }

    // ì˜¤ëŠ˜ ë‚ ì§œ í¬í•¨ í™•ì¸ ë° ìë™ ì—…ë°ì´íŠ¸ ì²´í¬ë°•ìŠ¤ í™•ì¸
    const endDate = document.getElementById('end-date').value;
    const autoUpdate = document.getElementById('auto-update-check').checked;
    const today = new Date().toISOString().split('T')[0]; // ì˜¤ëŠ˜ ë‚ ì§œ YYYY-MM-DD í˜•ì‹

    if (endDate === today && autoUpdate) {
      // 10ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
      customDateInterval = setInterval(fetchCustomDateData, 10000);
    }
  }

  document.getElementById('auto-update-check').addEventListener('change', function() {
    console.log('ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë³€ê²½: ', this.checked);

    // ì´ì „ íƒ€ì´ë¨¸ ì´ˆê¸°í™”
    if (customDateInterval) {
      clearInterval(customDateInterval);
      customDateInterval = null;
    }

    if (this.checked) {
      // ì²´í¬í–ˆì„ ë•Œ ì¼ë‹¨ ë°”ë¡œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      fetchCustomDateData();

      // í˜„ì¬ ì‹œìŠ¤í…œ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸° (ë” ì •í™•í•œ ë°©ë²•)
      const now = new Date();
      const today = now.getFullYear() + '-' +
          String(now.getMonth() + 1).padStart(2, '0') + '-' +
          String(now.getDate()).padStart(2, '0');

      const endDate = document.getElementById('end-date').value;
      console.log('â­ì •í™•í•œ ë‚ ì§œ ë¹„êµ:', endDate, today, endDate === today);

      if (endDate === today) {
        console.log('ğŸ”„ 10ì´ˆ ìë™ ì—…ë°ì´íŠ¸ ì„¤ì • ì„±ê³µ!!');
        // 10ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸ ì„¤ì •
        customDateInterval = setInterval(fetchCustomDateData, 10000);
      }
    }
  });

  // ì›Œë“œí”„ë ˆìŠ¤ ì¹´í…Œê³ ë¦¬ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
  function loadWpCategoryData() {
    fetch('/api/wp-categories-data')
    .then(response => {
      if (!response.ok) {
        throw new Error('ì¹´í…Œê³ ë¦¬ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”!');
      }
      return response.json();
    })
    .then(data => {
      wpCategoryData = data;

      // ë“œë¡­ë‹¤ìš´ì— ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì¶”ê°€
      const todayFullSelect = document.getElementById('today-full-category-select');
      const customDateFullSelect = document.getElementById('custom-date-full-category-select');
      
      // ê¸°ì¡´ ì˜µì…˜ ì´ˆê¸°í™” (ì „ì²´ ì¹´í…Œê³ ë¦¬ ì˜µì…˜ì€ ìœ ì§€)
      if (todayFullSelect) {
        todayFullSelect.innerHTML = '<option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>';
      }
      if (customDateFullSelect) {
        customDateFullSelect.innerHTML = '<option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>';
      }
      
      if (!data.categories) {
        console.error('ì¹´í…Œê³ ë¦¬ ë°ì´í„°ê°€ ë¹„ì–´ìˆì–´ìš”!');
        return;
      }
      
      // í¬ìŠ¤íŠ¸ê°€ ìˆëŠ” ì¹´í…Œê³ ë¦¬ë§Œ í•„í„°ë§
      const categoriesWithPosts = new Set();
      Object.values(data.posts).forEach(categoryIds => {
        if (categoryIds && Array.isArray(categoryIds)) {
          categoryIds.forEach(catId => categoriesWithPosts.add(catId.toString()));
        }
      });
      
      // í¬ìŠ¤íŠ¸ê°€ ìˆëŠ” ì¹´í…Œê³ ë¦¬ë§Œ ì •ë ¬ (ì´ë¦„ ê¸°ì¤€)
      const sortedCategories = Object.entries(data.categories)
        .filter(([id, name]) => categoriesWithPosts.has(id))
        .sort((a, b) => a[1].localeCompare(b[1]));
      
      // ë“œë¡­ë‹¤ìš´ì— ì˜µì…˜ ì¶”ê°€
      sortedCategories.forEach(([id, name]) => {
        // HTML ì—”í‹°í‹° ë””ì½”ë”©
        const decodedName = name.replace(/&amp;/g, '&');
        
        // ì˜¤ëŠ˜ ì „ì²´ íƒ­ ë“œë¡­ë‹¤ìš´
        const option1 = document.createElement('option');
        option1.value = id;
        option1.textContent = decodedName;
        if (todayFullSelect) todayFullSelect.appendChild(option1);
        
        // ë‚ ì§œ ì§€ì • íƒ­ ë“œë¡­ë‹¤ìš´
        const option2 = document.createElement('option');
        option2.value = id;
        option2.textContent = decodedName;
        if (customDateFullSelect) customDateFullSelect.appendChild(option2);
      });
    })
    .catch(error => {
      console.error('ì¹´í…Œê³ ë¦¬ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    });
  }

  // URLì—ì„œ í¬ìŠ¤íŠ¸ ID ì¶”ì¶œ í•¨ìˆ˜
  function extractPostId(pagePath) {
    // /?p=59696 í˜•ì‹
    let match = pagePath.match(/[?&]p=(\d+)/);
    if (match) return match[1];
    
    // /12345/ í˜•ì‹ (WordPress Pretty Permalink)
    match = pagePath.match(/^\/(\d+)\/?$/);
    if (match) return match[1];
    
    // /posts/12345/ ë˜ëŠ” /p/12345/ ê°™ì€ í˜•ì‹ë„ ì²˜ë¦¬
    match = pagePath.match(/\/(\d+)\/?$/);
    if (match) return match[1];
    
    return null;
  }

  // ì „ì²´ ì œëª© íƒ­ì—ì„œ ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§ í•¨ìˆ˜
  function filterByCategoryInFullTab(mainTab, categoryId) {
    // í•„í„°ë§ ì•ˆ í•¨ (ì „ì²´ ì¹´í…Œê³ ë¦¬ ì„ íƒ)
    if (!categoryId) {
      // ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›
      if (mainTab === 'today' && currentPageViewsData.today) {
        updatePageViewsTable(currentPageViewsData.today, 'today-page-title-views');
      } else if (mainTab === 'custom-date' && currentPageViewsData.customDate) {
        updatePageViewsTable(currentPageViewsData.customDate, 'custom-date-page-title-views');
      }
      return;
    }
    
    // í•„í„°ë§ëœ ë°ì´í„° ìƒì„±
    let filteredData = [];
    let sourceData = null;
    
    if (mainTab === 'today' && currentPageViewsData.today) {
      sourceData = currentPageViewsData.today;
    } else if (mainTab === 'custom-date' && currentPageViewsData.customDate) {
      sourceData = currentPageViewsData.customDate;
    }
    
    if (sourceData && wpCategoryData) {
      filteredData = sourceData.filter(item => {
        const postId = extractPostId(item.pagePath);
        if (!postId) return false;
        
        const postCategories = wpCategoryData.posts[postId];
        return postCategories && postCategories.includes(parseInt(categoryId));
      });
    }
    
    // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
    updatePageViewsTable(filteredData, `${mainTab}-page-title-views`);
  }

  // ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§ í•¨ìˆ˜
  function filterByCategory(mainTab, categoryId) {
    // ë“œë¡­ë‹¤ìš´ í‘œì‹œ ì—¬ë¶€ ê²°ì •
    const filterContainer = document.getElementById(`${mainTab}-category-filter`);
    
    if (!categoryId) {
      // ì „ì²´ ì¹´í…Œê³ ë¦¬ ì„ íƒì‹œ ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›
      if (mainTab === 'today' && currentPageViewsData.today) {
        updatePageViewsTable(currentPageViewsData.today, 'today-category-views');
      } else if (mainTab === 'custom-date' && currentPageViewsData.customDate) {
        updatePageViewsTable(currentPageViewsData.customDate, 'custom-date-category-views');
      }
      return;
    }
    
    // í•„í„°ë§ëœ ë°ì´í„° ìƒì„±
    let filteredData = [];
    let sourceData = null;
    
    if (mainTab === 'today' && currentPageViewsData.today) {
      sourceData = currentPageViewsData.today;
    } else if (mainTab === 'custom-date' && currentPageViewsData.customDate) {
      sourceData = currentPageViewsData.customDate;
    }
    
    if (sourceData && wpCategoryData) {
      filteredData = sourceData.filter(item => {
        const postId = extractPostId(item.pagePath);
        if (!postId) return false;
        
        const postCategories = wpCategoryData.posts[postId];
        return postCategories && postCategories.includes(parseInt(categoryId));
      });
    }
    
    // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
    updatePageViewsTable(filteredData, `${mainTab}-category-views`);
  }

  // ì›Œë“œí”„ë ˆìŠ¤ ì¹´í…Œê³ ë¦¬ ë™ê¸°í™” í•¨ìˆ˜ ì¶”ê°€ (ê°œì„  ë²„ì „)
  function syncWordPressCategories(forceFullSync = false) {
    const syncButton = document.querySelector('.sync-button');
    const fullSyncButton = document.querySelector('.full-sync-button');
    const originalText = syncButton.innerHTML;
    const originalFullSyncText = fullSyncButton.innerHTML;

    // ëª¨ë“  ë™ê¸°í™” ë°°ë„ˆë¥¼ í‘œì‹œí•©ë‹ˆë‹¤
    document.querySelectorAll('.sync-banner').forEach(banner => {
      banner.textContent = forceFullSync ?
          'â³ ì „ì²´ ì¹´í…Œê³ ë¦¬ ë™ê¸°í™” ì¤‘... ì‹œê°„ì´ ì¡°ê¸ˆ ê±¸ë¦´ ìˆ˜ ìˆì–´ìš”!' :
          'â³ ì¹´í…Œê³ ë¦¬ ë™ê¸°í™” ì¤‘... ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!';
      banner.classList.add('visible');
    });

    // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½ ë° ë¹„í™œì„±í™”
    syncButton.innerHTML = '<span class="sync-button-icon">â³</span> ë™ê¸°í™” ì¤‘...';
    syncButton.disabled = true;
    fullSyncButton.innerHTML = '<span class="sync-button-icon">â³</span> ë™ê¸°í™” ì¤‘...';
    fullSyncButton.disabled = true;

    // API í˜¸ì¶œ URL ìˆ˜ì • (forceFullSync íŒŒë¼ë¯¸í„° ì¶”ê°€)
    fetch(`/api/sync-wordpress-categories${forceFullSync ? '?forceFullSync=true' : ''}`)
    .then(response => response.json())
    .then(data => {
      // ëª¨ë“  ë™ê¸°í™” ë°°ë„ˆ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.sync-banner').forEach(banner => {
        banner.textContent = 'âœ… ë™ê¸°í™” ì™„ë£Œ! ì¹´í…Œê³ ë¦¬ ë°ì´í„°ê°€ ìµœì‹  ìƒíƒœì˜ˆìš”! ğŸ’';

        // 3ì´ˆ í›„ì— ë°°ë„ˆ ìˆ¨ê¸°ê¸°
        setTimeout(() => {
          banner.classList.remove('visible');
        }, 3000);
      });

      // ë™ê¸°í™” í›„ ë°ì´í„° ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°
      fetchTodayData();
      fetchLast30MinData();
      
      // ì¹´í…Œê³ ë¦¬ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
      loadWpCategoryData();

      // ë²„íŠ¼ ë³µì›
      syncButton.innerHTML = originalText;
      syncButton.disabled = false;
      fullSyncButton.innerHTML = originalFullSyncText;
      fullSyncButton.disabled = false;
    })
    .catch(error => {
      console.error('ì¹´í…Œê³ ë¦¬ ë™ê¸°í™” ì‹¤íŒ¨:', error);

      // ëª¨ë“  ë™ê¸°í™” ë°°ë„ˆ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.sync-banner').forEach(banner => {
        banner.textContent = 'âŒ ë™ê¸°í™” ì‹¤íŒ¨! ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”! ğŸ˜¢';
      });

      // ë²„íŠ¼ ë³µì›
      syncButton.innerHTML = originalText;
      syncButton.disabled = false;
      fullSyncButton.innerHTML = originalFullSyncText;
      fullSyncButton.disabled = false;
    });
  }

  // ê¸°ê°„ ë¹„êµ ê´€ë ¨ í•¨ìˆ˜ë“¤
  let comparisonDataCache = {
    periodA: null,
    periodB: null,
    currentFilter: 'all'
  };

  // ê¸°ê°„ ë‚ ì§œ ìœ íš¨ì„± ê²€ì‚¬
  function validatePeriodDates(period) {
    const startDate = document.getElementById(`period-${period}-start`).value;
    const endDate = document.getElementById(`period-${period}-end`).value;

    if (startDate && endDate && new Date(startDate) > new Date(endDate)) {
      alert(`ğŸš¨ ê¸°ê°„ ${period.toUpperCase()}ì˜ ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ì„ ìˆ˜ ì—†ì–´ìš”!`);
      document.getElementById(`period-${period}-end`).value = startDate;
    }
  }

  // ë¹ ë¥¸ ë‚ ì§œ ì„ íƒ í•¨ìˆ˜
  function setQuickDateRange(days) {
    const today = new Date();
    const excludeToday = document.getElementById('exclude-today-check').checked;
    
    // ì „ì¼ ê¸°ì¤€ ì²´í¬ì‹œ í•˜ë£¨ ì „ë¶€í„° ì‹œì‘
    if (excludeToday) {
      today.setDate(today.getDate() - 1);
    }
    
    // ê¸°ê°„ B ì„¤ì • (ìµœê·¼ ê¸°ê°„: ì˜¤ëŠ˜ë¶€í„° ì§€ì •ëœ ì¼ìˆ˜ ì „ê¹Œì§€)
    const periodBEnd = new Date(today);
    const periodBStart = new Date(today);
    
    if (days === 1) {
      // ì˜¤ëŠ˜ë§Œ (ë˜ëŠ” ì–´ì œë§Œ)
      periodBStart.setDate(today.getDate());
    } else {
      // ì§€ì •ëœ ì¼ìˆ˜ ì „
      periodBStart.setDate(today.getDate() - days + 1);
    }
    
    // ê¸°ê°„ A ì„¤ì • (ì´ì „ ê¸°ê°„: ê¸°ê°„ B ë°”ë¡œ ì „ì˜ ë™ì¼í•œ ê¸°ê°„)
    const periodAEnd = new Date(periodBStart);
    periodAEnd.setDate(periodAEnd.getDate() - 1);
    
    const periodAStart = new Date(periodAEnd);
    if (days === 1) {
      periodAStart.setDate(periodAEnd.getDate());
    } else {
      periodAStart.setDate(periodAEnd.getDate() - days + 1);
    }
    
    // ë‚ ì§œ í¬ë§· í•¨ìˆ˜
    const formatDate = (date) => {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    };
    
    // ì…ë ¥ í•„ë“œì— ê°’ ì„¤ì •
    document.getElementById('period-a-start').value = formatDate(periodAStart);
    document.getElementById('period-a-end').value = formatDate(periodAEnd);
    document.getElementById('period-b-start').value = formatDate(periodBStart);
    document.getElementById('period-b-end').value = formatDate(periodBEnd);
  }

  // ë¹„êµ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  function fetchComparisonData() {
    const periodAStart = document.getElementById('period-a-start').value;
    const periodAEnd = document.getElementById('period-a-end').value;
    const periodBStart = document.getElementById('period-b-start').value;
    const periodBEnd = document.getElementById('period-b-end').value;

    if (!periodAStart || !periodAEnd || !periodBStart || !periodBEnd) {
      alert('â“ ëª¨ë“  ê¸°ê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
      return;
    }

    // ë¡œë”© í‘œì‹œ
    const categoryTable = document.getElementById('comparison-category-table');
    categoryTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">â³ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</td></tr>';

    // ë‘ ê¸°ê°„ì˜ ë°ì´í„°ë¥¼ ë³‘ë ¬ë¡œ ê°€ì ¸ì˜¤ê¸°
    Promise.all([
      fetch(`/api/custom-date-pageviews?startDate=${periodAStart}&endDate=${periodAEnd}`).then(r => r.json()),
      fetch(`/api/custom-date-pageviews?startDate=${periodBStart}&endDate=${periodBEnd}`).then(r => r.json())
    ])
    .then(([dataA, dataB]) => {
      comparisonDataCache.periodA = dataA;
      comparisonDataCache.periodB = dataB;
      
      // ì¹´í…Œê³ ë¦¬ë³„ ë¹„êµ ë°ì´í„° ìƒì„± ë° í‘œì‹œ
      updateComparisonCategoryTable();
    })
    .catch(error => {
      console.error('ë¹„êµ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
      categoryTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">âŒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨!</td></tr>';
    });
  }

  // ì¹´í…Œê³ ë¦¬ë³„ ë¹„êµ í…Œì´ë¸” ì—…ë°ì´íŠ¸
  function updateComparisonCategoryTable() {
    if (!comparisonDataCache.periodA || !comparisonDataCache.periodB || !wpCategoryData) {
      return;
    }

    const categoryDataA = comparisonDataCache.periodA.categoryViews || {};
    const categoryDataB = comparisonDataCache.periodB.categoryViews || {};

    // ì „ì²´ ì¡°íšŒìˆ˜ ê³„ì‚°
    const totalViewsA = Object.values(categoryDataA).reduce((sum, views) => sum + views, 0);
    const totalViewsB = Object.values(categoryDataB).reduce((sum, views) => sum + views, 0);

    // ëª¨ë“  ì¹´í…Œê³ ë¦¬ ìˆ˜ì§‘
    const allCategories = new Set([
      ...Object.keys(categoryDataA),
      ...Object.keys(categoryDataB)
    ]);

    // ì¹´í…Œê³ ë¦¬ë³„ ë¹„êµ ë°ì´í„° ìƒì„±
    let comparisonData = Array.from(allCategories).map(category => {
      const viewsA = categoryDataA[category] || 0;
      const viewsB = categoryDataB[category] || 0;
      const change = viewsB - viewsA;
      const changeRate = viewsA > 0 ? ((viewsB - viewsA) / viewsA * 100) : (viewsB > 0 ? 100 : 0);
      const shareA = totalViewsA > 0 ? (viewsA / totalViewsA * 100) : 0;
      const shareB = totalViewsB > 0 ? (viewsB / totalViewsB * 100) : 0;

      return {
        category,
        viewsA: Math.round(viewsA),
        viewsB: Math.round(viewsB),
        change,
        changeRate,
        shareA,
        shareB
      };
    });

    // í•„í„° ì ìš©
    comparisonData = applyFilterToData(comparisonData, comparisonDataCache.currentFilter);

    // í…Œì´ë¸” ì—…ë°ì´íŠ¸
    const tableBody = document.getElementById('comparison-category-table');
    tableBody.innerHTML = '';

    if (comparisonData.length === 0) {
      tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">ğŸ˜¢ ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ì–´ìš”!</td></tr>';
      return;
    }

    comparisonData.forEach((item, index) => {
      const row = document.createElement('tr');
      row.className = 'expandable-row';
      row.onclick = () => showCategoryDetail(item.category);

      // ìˆœë²ˆ
      const numCell = document.createElement('td');
      numCell.textContent = index + 1;
      row.appendChild(numCell);

      // ì¹´í…Œê³ ë¦¬ëª…
      const categoryCell = document.createElement('td');
      categoryCell.innerHTML = `${item.category} <small style="color: #666;">(í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸°)</small>`;
      row.appendChild(categoryCell);

      // ê¸°ê°„ A
      const viewsACell = document.createElement('td');
      if (item.viewsA > item.viewsB) {
        viewsACell.innerHTML = `<strong>${item.viewsA.toLocaleString()}</strong>`;
      } else {
        viewsACell.textContent = item.viewsA.toLocaleString();
      }
      row.appendChild(viewsACell);

      // ê¸°ê°„ B
      const viewsBCell = document.createElement('td');
      if (item.viewsB > item.viewsA) {
        viewsBCell.innerHTML = `<strong>${item.viewsB.toLocaleString()}</strong>`;
      } else {
        viewsBCell.textContent = item.viewsB.toLocaleString();
      }
      row.appendChild(viewsBCell);

      // ë³€í™”ëŸ‰
      const changeCell = document.createElement('td');
      if (item.change > 0) {
        changeCell.innerHTML = `<span class="increase">+${item.change.toLocaleString()}â†‘</span>`;
      } else if (item.change < 0) {
        changeCell.innerHTML = `<span class="decrease">${item.change.toLocaleString()}â†“</span>`;
      } else {
        changeCell.innerHTML = '<span class="unchanged">0</span>';
      }
      row.appendChild(changeCell);

      // ë³€í™”ìœ¨
      const changeRateCell = document.createElement('td');
      if (item.changeRate > 0) {
        changeRateCell.innerHTML = `<span class="change-badge increase">+${item.changeRate.toFixed(1)}%</span>`;
      } else if (item.changeRate < 0) {
        changeRateCell.innerHTML = `<span class="change-badge decrease">${item.changeRate.toFixed(1)}%</span>`;
      } else {
        changeRateCell.innerHTML = '<span class="unchanged">0%</span>';
      }
      row.appendChild(changeRateCell);

      // ê¸°ê°„ A ë¹„ì¤‘
      const shareACell = document.createElement('td');
      if (item.shareA > item.shareB) {
        shareACell.innerHTML = `<span style="color: #2196F3;"><strong>${item.shareA.toFixed(1)}%</strong></span>`;
      } else {
        shareACell.innerHTML = `<span style="color: #2196F3;">${item.shareA.toFixed(1)}%</span>`;
      }
      row.appendChild(shareACell);

      // ê¸°ê°„ B ë¹„ì¤‘
      const shareBCell = document.createElement('td');
      if (item.shareB > item.shareA) {
        shareBCell.innerHTML = `<span style="color: #FF9800;"><strong>${item.shareB.toFixed(1)}%</strong></span>`;
      } else {
        shareBCell.innerHTML = `<span style="color: #FF9800;">${item.shareB.toFixed(1)}%</span>`;
      }
      row.appendChild(shareBCell);

      tableBody.appendChild(row);
    });
  }

  // í•„í„° ì ìš© í•¨ìˆ˜
  function applyFilterToData(data, filterType) {
    switch (filterType) {
      case 'top-increase':
        return data
          .filter(item => item.change > 0)
          .sort((a, b) => b.change - a.change)
          .slice(0, 25);
      
      case 'top-decrease':
        return data
          .filter(item => item.change < 0)
          .sort((a, b) => a.change - b.change)
          .slice(0, 25);
      
      
      case 'rapid-growth':
        return data.filter(item => item.changeRate >= 100);
      
      default:
        return data.sort((a, b) => b.change - a.change);
    }
  }

  // í•„í„° ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬
  function applyComparisonFilter(filterType) {
    comparisonDataCache.currentFilter = filterType;
    
    // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
    document.querySelectorAll('#comparison-filters .filter-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // ìƒì„¸ ë¹„êµ ì°½ ë‹«ê¸°
    closeComparisonDetail();
    
    // í…Œì´ë¸” ì—…ë°ì´íŠ¸
    updateComparisonCategoryTable();
  }

  // ì¹´í…Œê³ ë¦¬ ìƒì„¸ ë³´ê¸°
  function showCategoryDetail(categoryName) {
    if (!comparisonDataCache.periodA || !comparisonDataCache.periodB || !wpCategoryData) {
      return;
    }

    // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ì¹´í…Œê³ ë¦¬ ID ì°¾ê¸°
    let categoryId = null;
    Object.entries(wpCategoryData.categories).forEach(([id, name]) => {
      if (name.replace(/&amp;/g, '&') === categoryName) {
        categoryId = id;
      }
    });

    if (!categoryId) return;

    // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ í¬ìŠ¤íŠ¸ë“¤ í•„í„°ë§
    const postsInCategory = Object.entries(wpCategoryData.posts)
      .filter(([postId, categoryIds]) => categoryIds && categoryIds.includes(parseInt(categoryId)))
      .map(([postId]) => postId);

    // í¬ìŠ¤íŠ¸ë³„ ì¡°íšŒìˆ˜ ë°ì´í„° ìˆ˜ì§‘
    const postDataA = {};
    const postDataB = {};

    comparisonDataCache.periodA.pageViews.forEach(page => {
      const postId = extractPostId(page.pagePath);
      if (postId && postsInCategory.includes(postId)) {
        postDataA[postId] = {
          title: page.pageTitle,
          views: page.pageViews
        };
      }
    });

    comparisonDataCache.periodB.pageViews.forEach(page => {
      const postId = extractPostId(page.pagePath);
      if (postId && postsInCategory.includes(postId)) {
        postDataB[postId] = {
          title: page.pageTitle,
          views: page.pageViews
        };
      }
    });

    // ëª¨ë“  í¬ìŠ¤íŠ¸ ìˆ˜ì§‘
    const allPostIds = new Set([...Object.keys(postDataA), ...Object.keys(postDataB)]);
    
    // í¬ìŠ¤íŠ¸ë³„ ë¹„êµ ë°ì´í„° ìƒì„±
    const postComparison = Array.from(allPostIds).map(postId => {
      const dataA = postDataA[postId] || { title: '(ì œëª© ì—†ìŒ)', views: 0 };
      const dataB = postDataB[postId] || { title: dataA.title, views: 0 };
      const change = dataB.views - dataA.views;
      const changeRate = dataA.views > 0 ? ((dataB.views - dataA.views) / dataA.views * 100) : (dataB.views > 0 ? 100 : 0);

      return {
        title: dataB.title || dataA.title,
        viewsA: Math.round(dataA.views),
        viewsB: Math.round(dataB.views),
        change,
        changeRate
      };
    }).sort((a, b) => b.change - a.change);

    // ìƒì„¸ í…Œì´ë¸” í‘œì‹œ
    const detailBox = document.getElementById('comparison-post-detail');
    const detailTitle = document.getElementById('comparison-post-detail-title');
    const tableBody = document.getElementById('comparison-post-table');

    detailTitle.textContent = `ğŸ“ˆ "${categoryName}" ì¹´í…Œê³ ë¦¬ í¬ìŠ¤íŠ¸ë³„ ìƒì„¸ ë¹„êµ`;
    detailBox.style.display = 'block';
    
    tableBody.innerHTML = '';
    postComparison.forEach((post, index) => {
      const row = document.createElement('tr');

      // ìˆœë²ˆ
      const numCell = document.createElement('td');
      numCell.textContent = index + 1;
      row.appendChild(numCell);

      // í¬ìŠ¤íŠ¸ ì œëª©
      const titleCell = document.createElement('td');
      titleCell.textContent = post.title;
      row.appendChild(titleCell);

      // ê¸°ê°„ A
      const viewsACell = document.createElement('td');
      if (post.viewsA > post.viewsB) {
        viewsACell.innerHTML = `<strong>${post.viewsA.toLocaleString()}</strong>`;
      } else {
        viewsACell.textContent = post.viewsA.toLocaleString();
      }
      row.appendChild(viewsACell);

      // ê¸°ê°„ B
      const viewsBCell = document.createElement('td');
      if (post.viewsB > post.viewsA) {
        viewsBCell.innerHTML = `<strong>${post.viewsB.toLocaleString()}</strong>`;
      } else {
        viewsBCell.textContent = post.viewsB.toLocaleString();
      }
      row.appendChild(viewsBCell);

      // ë³€í™”ëŸ‰
      const changeCell = document.createElement('td');
      if (post.change > 0) {
        changeCell.innerHTML = `<span class="increase">+${post.change.toLocaleString()}â†‘</span>`;
      } else if (post.change < 0) {
        changeCell.innerHTML = `<span class="decrease">${post.change.toLocaleString()}â†“</span>`;
      } else {
        changeCell.innerHTML = '<span class="unchanged">0</span>';
      }
      row.appendChild(changeCell);

      // ë³€í™”ìœ¨
      const changeRateCell = document.createElement('td');
      if (post.changeRate > 0) {
        changeRateCell.innerHTML = `<span class="change-badge increase">+${post.changeRate.toFixed(1)}%</span>`;
      } else if (post.changeRate < 0) {
        changeRateCell.innerHTML = `<span class="change-badge decrease">${post.changeRate.toFixed(1)}%</span>`;
      } else {
        changeRateCell.innerHTML = '<span class="unchanged">0%</span>';
      }
      row.appendChild(changeRateCell);

      tableBody.appendChild(row);
    });

    // ìŠ¤í¬ë¡¤
    detailBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }

  // ìƒì„¸ ë¹„êµ ì°½ ë‹«ê¸° í•¨ìˆ˜
  function closeComparisonDetail() {
    const detailBox = document.getElementById('comparison-post-detail');
    detailBox.style.display = 'none';
  }

  // ë‚ ì§œ ì§€ì • íƒ­ìš© ë¹ ë¥¸ ë‚ ì§œ ì„ íƒ í•¨ìˆ˜
  function setCustomDateRange(days) {
    const today = new Date();
    const excludeToday = document.getElementById('custom-date-exclude-today').checked;
    
    // ì „ì¼ ê¸°ì¤€ ì²´í¬ì‹œ í•˜ë£¨ ì „ë¶€í„° ì‹œì‘
    if (excludeToday) {
      today.setDate(today.getDate() - 1);
    }
    
    const endDate = new Date(today);
    const startDate = new Date(today);
    
    if (days === 1) {
      // ì˜¤ëŠ˜ë§Œ (ë˜ëŠ” ì–´ì œë§Œ)
      startDate.setDate(today.getDate());
    } else {
      // ì§€ì •ëœ ì¼ìˆ˜ ì „
      startDate.setDate(today.getDate() - days + 1);
    }
    
    // ë‚ ì§œ í¬ë§· í•¨ìˆ˜
    const formatDate = (date) => {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    };
    
    // ì…ë ¥ í•„ë“œì— ê°’ ì„¤ì •
    document.getElementById('start-date').value = formatDate(startDate);
    document.getElementById('end-date').value = formatDate(endDate);
  }

</script>
</body>
</html>